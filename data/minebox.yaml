---
lookup_options:
  '^minebox::(.*)':
    merge:
      strategy: deep
      merge_hash_arrays: true

docker::docker_users:
  - "%{lookup('minebox::miner_user')}"

minebox::gpu_monitoring_network: minerstats
minebox::cpu_mining: false
minebox::base_path: '/minebox'
minebox::storage_path: undef
minebox::miner_user: 'miner'
minebox::miner_group: 'miners'
minebox::miner_user_pwd: undef
minebox::miner_user_ssh_key: undef
minebox::miner_user_groups:
  - 'adm'
  - 'sudo'
  - 'video'
minebox::grub_options: 'quiet splash nomodeset'

minebox::packages_base:
  - "linux-headers-%{facts.kernelrelease}"
  - 'libcurl3'
  - 'build-essential'
  - 'dkms'
  - 'git'
  - 'screen'
  - 'vim'
  - 'nmap'
  - 'ncdu'
  - 'busybox'
  - 'inxi'
  - 'links'
  - 'unzip'
  - 'openssh-server'
  - 'htop'

minebox::packages_xorg:
  - xserver-xorg
  - xserver-xorg-core
  - xserver-xorg-input-evdev
  - xserver-xorg-video-dummy
  - x11-xserver-utils
  - xdm

minebox::folders:
  - drivers
  - scripts
  - files
  - miners
  - tools

minebox::miners:
  amd:
  nv:
    dstm-equihash:
      version: 0.5.8
      source: 'https://s3-us-west-1.amazonaws.com/mastermine/minebox/zm_0.5.8.tar.gz'
      file: zm_0.5.8.tar.gz
      creates: zm
    ewbf-equihash:
      version: 0.3.4b
      source: 'https://s3-us-west-1.amazonaws.com/mastermine/minebox/Zec_Miner_0.3.4b_Linux_Bin.tar.gz'
      file: Zec_Miner_0.3.4b_Linux_Bin.tar.gz
      creates: miner
  hybrid:
    claymore-ethash:
      version: 11.7
      source: 'https://s3-us-west-1.amazonaws.com/mastermine/minebox/claymore_eth_11.7_linux.tar.gz'
      file: claymore.tar.gz
      creates: ethdcrminer64
    claymore-equihash:
      version: 12.6
      source: 'https://s3-us-west-1.amazonaws.com/mastermine/minebox/claymore_ZCash_AMD_GPU_Miner_v12.6_LINUX.tar.gz'
      file: claymore-equi.tar.gz
      creates: zecminer64
    ethminer:
      version: 0.14.0
      source: 'https://github.com/ethereum-mining/ethminer/releases/download/v0.14.0/ethminer-0.14.0-Linux.tar.gz'
      file: ethminer.tar.gz
      creates: ethminer

minebox::tools:
  hybrid:
  nv:
  amd:
    atiflash:
      version: 4.25
      source: 'https://s3-us-west-1.amazonaws.com/mastermine/minebox/atiflash_linux.tar.xz'
      files: atiflash.tar.xz
      creates: atiflash
      create_subdir: false

minebox::docker::config::swarm_mode: false

minebox::monitoring:
  enable: false
  collectd_network_server_hostname: 'undef'

minebox:monitor:mstatsd:
  docker_image: 'cryptojunkies/mstats-exp:latest'
  api_port: '3333'

minebox::nv_conf:
  gpus: undef
  enable: false
  use_docker: true
  gpu_fan: 0
  driver: 'nvidia-384'
  docker_pkg: 'nvidia-docker2'

minebox::amd_conf:
  gpus: undef
  enable: false
  use_docker: true
  gpu_fan: 0
  driver: 'amdgpu-pro-17.50-511655'

minebox::accounts:
  eth: 'undef'
  lbc: 'undef'
  xmr: 'undef'
  sia: 'undef'
  zcl: 'undef'

minebox::miner_defaults:
  monitor:
    api_port:
      claymore: '3333'
      ethminer: '3333'
      dstm: '2222'
  amd:
    eth:
      ethminer:
        repo: cryptojunkies
        image: ethminer
        tag: latest-amd
        command: -RH -U -S us1.ethermine.org:4444 -FS us2.ethermine.org:4444 --farm-recheck 2000 -O %{minebox::accounts.eth}.%{facts.hostname}-WORKER_ID -HWMON --api-port %{minebox:monitor.api_port.ethminer} --opencl --opencl-device GPU_ID
      cm_eth_only:
        repo: cryptojunkies
        image: claymore
        tag: eth-amd-latest
        command: -epool us1.ethermine.org:4444 -epool us2.ethermine.org:4444 -ewal %{minebox::accounts.eth}.%{facts.hostname}-WORKER_ID -epsw x -mode 1 -mport %{minebox:monitor.api_port.claymore} -platform 1 -di GPU_ID
  nv:
    zec:
      flypool:
        repo: cryptojunkies
        image: dstm
        tag: latest
        command: --server us1-zcash.flypool.org --port 3333 --user %{minebox::accounts.zec}.%{facts.hostname}-WORKER_ID --pass x --telemetry 0.0.0.0:%{minebox:monitor.api_port.dstm}
    eth:
      ethminer_stable:
        repo: cryptojunkies
        image: ethminer
        tag: 0.14.0-cuda9.0
        command: -RH -U -S us1.ethermine.org:4444 -FS us2.ethermine.org:4444 --farm-recheck 2000 -O %{minebox::accounts.eth}.%{facts.hostname}-WORKER_ID -HWMON --api-port %{minebox:monitor.api_port.ethminer}
      ethminer_latest:
        repo: cryptojunkies
        image: ethminer
        tag: latest-cuda9.0
        command: -RH -U -S us1.ethermine.org:4444 -FS us2.ethermine.org:4444 --farm-recheck 2000 -O %{minebox::accounts.eth}.%{facts.hostname}-WORKER_ID -HWMON --api-port %{minebox:monitor.api_port.ethminer}

minebox::docker::services::eth_proxy::enable: false
minebox::docker::services::eth_proxy::debug: false
minebox::docker::services::eth_proxy::wallet: "%{alias('minebox::accounts.eth')}"
minebox::docker::services::eth_proxy::pool_host: 'undef'
minebox::docker::services::eth_proxy::pool_port: 'undef'
minebox::docker::services::eth_proxy::pool_host_failover1: "%{alias('minebox::docker::services::eth_proxy::pool_host')}"
minebox::docker::services::eth_proxy::pool_port_failover1: "%{alias('minebox::docker::services::eth_proxy::pool_port')}"
minebox::docker::services::eth_proxy::pool_host_failover2: "%{alias('minebox::docker::services::eth_proxy::pool_host')}"
minebox::docker::services::eth_proxy::pool_port_failover2: "%{alias('minebox::docker::services::eth_proxy::pool_port')}"
minebox::docker::services::eth_proxy::pool_host_failover3: "%{alias('minebox::docker::services::eth_proxy::pool_host')}"
minebox::docker::services::eth_proxy::pool_port_failover3: "%{alias('inebox::docker::services::eth_proxy::pool_port')}"
minebox::docker::services::eth_proxy::traefik_host_name: 'undef'
minebox::docker::services::eth_proxy::traefik_port: '8080'
minebox::docker::services::eth_proxy::swarm_replicas: 1
minebox::docker::services::eth_proxy::docker_network_web: 'undef'
minebox::docker::services::eth_proxy::service_name: eth-proxy
minebox::docker::services::eth_proxy::image_name: 'cryptojunkies/eth-proxy:latest'